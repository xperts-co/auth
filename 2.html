<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join ALLEN</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="container">
        <!-- Step 1: Name -->
        <div id="step1">
            <img src="https://via.placeholder.com/150/E0F7FA/808080?Text=Illustration" alt="Illustration" class="illustration">
            <h2>We are excited to have you join the ALLEN family!</h2>
            <p>What should we call you?</p>
            <div class="form-group">
                <input type="text" id="fullName" class="form-input" placeholder="Student's full name" required>
            </div>
            <button class="btn" onclick="nextStep(2)">Next</button>
        </div>

        <!-- Step 2: Credentials -->
        <div id="step2" style="display: none;">
             <h2>Create your account</h2>
             <p>Enter your email and a secure password.</p>
            <div class="form-group">
                <input type="email" id="email" class="form-input" placeholder="Email" required>
            </div>
            <div class="form-group">
                <input type="password" id="password" class="form-input" placeholder="Password" required>
            </div>
            <button class="btn" onclick="nextStep(3)">Next</button>
        </div>

        <!-- Step 3: Class Selection -->
        <div id="step3" style="display: none;">
            <img src="https://via.placeholder.com/150/C8E6C9/808080?Text=Trophy" alt="Illustration" class="illustration">
            <h2>You selected, Class 6-10!</h2>
            <p>Please select your current class.</p>
            <div class="class-selector">
                <button class="class-btn" data-class="6">6th</button>
                <button class="class-btn" data-class="7">7th</button>
                <button class="class-btn" data-class="8">8th</button>
                <button class="class-btn" data-class="9">9th</button>
                <button class="class-btn" data-class="10">10th</button>
            </div>
            <button class="btn" onclick="submitSignup()">Finish Setup</button>
        </div>

        <!-- Step 4: Thank You -->
        <div id="step4" style="display: none;">
            <img src="https://via.placeholder.com/150/B3E5FC/808080?Text=Backpack" alt="Illustration" class="illustration">
            <h2>Thank you for sharing your details!</h2>
            <p>Let's setup your ALLEN experience</p>
            <button class="btn" onclick="goToDashboard()">Lets Go!</button>
        </div>
        <p id="error-message" class="error-message"></p>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>

    <!-- Local Scripts -->
    <script src="app.js"></script>
    <script>
        const studentData = {};
        const errorMessage = document.getElementById('error-message');

        function nextStep(step) {
            errorMessage.textContent = '';
            if (step === 2) {
                const name = document.getElementById('fullName').value;
                if (!name) {
                    errorMessage.textContent = "Please enter your full name.";
                    return;
                }
                studentData.name = name;
            }
            if (step === 3) {
                 const email = document.getElementById('email').value;
                 const password = document.getElementById('password').value;
                 if(!email || password.length < 6){
                     errorMessage.textContent = "Please enter a valid email and a password of at least 6 characters.";
                     return;
                 }
                 studentData.email = email;
                 studentData.password = password;
            }
            document.getElementById(`step${step - 1}`).style.display = 'none';
            document.getElementById(`step${step}`).style.display = 'block';
        }

        let selectedClass = null;
        document.querySelectorAll('.class-btn').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.class-btn').forEach(btn => btn.classList.remove('selected'));
                button.classList.add('selected');
                selectedClass = button.dataset.class;
            });
        });

        function submitSignup() {
            if (!selectedClass) {
                errorMessage.textContent = "Please select your class.";
                return;
            }
            studentData.class = selectedClass;
            
            // Create user with Firebase Auth
            auth.createUserWithEmailAndPassword(studentData.email, studentData.password)
                .then((userCredential) => {
                    // Save additional data to Firestore
                    const user = userCredential.user;
                    return db.collection('users').doc(user.uid).set({
                        name: studentData.name,
                        email: studentData.email,
                        class: studentData.class,
                        role: 'student' // Assign role
                    });
                })
                .then(() => {
                    nextStep(4); // Show thank you screen
                })
                .catch((error) => {
                    errorMessage.textContent = error.message;
                });
        }
        
        function goToDashboard() {
            window.location.replace('3.html');
        }

    </script>
</body>
</html>
